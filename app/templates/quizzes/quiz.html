{% extends "base.html" %}

{% block content %}
  {% set anon = is_anon|default(false) %}

  <h1 class="page-title">{{ quiz.title }}</h1>
  <p class="page-subtitle">Pass mark: {{ pass_mark }}%. Answer all questions then submit.</p>

  {% if anon %}
    <div class="topic-lock-hint" style="margin: 12px 0;">
      ğŸ” Please <a href="{{ url_for('auth.login', next=request.path) }}">log in</a> to take quizzes and track your progress.
    </div>
  {% endif %}

  <div class="quiz-shell">
    <div class="quiz-top">
      <span class="badge">ğŸ§  Quiz</span>
      <span class="badge">ğŸ“ {{ quiz.questions|length }} questions</span>
      <span class="badge">ğŸ¯ {{ pass_mark }}% to pass</span>
    </div>

    <form class="quiz-form" method="post" action="{{ url_for('quizzes.submit', slug=slug) }}">
      {% for q in quiz.questions %}
        {% set q_index = loop.index0 %}
        <div class="quiz-card">
          <div class="quiz-qhead">
            <div class="qnum">Q{{ loop.index }}</div>
            <div class="qmeta">
              <div class="qprogress">Question {{ loop.index }} of {{ quiz.questions|length }}</div>
              <div class="qtext">{{ q.q }}</div>
            </div>
          </div>

          <div class="choices">
            {% for choice in q.choices %}
              <label class="choice">
                <input
                  type="radio"
                  name="q{{ q_index }}"
                  value="{{ loop.index0 }}"
                  {% if not anon %}required{% endif %}
                  {% if anon %}disabled{% endif %}
                >
                <span class="choice-dot"></span>
                <span class="choice-text">{{ choice }}</span>
              </label>
            {% endfor %}
          </div>
        </div>
      {% endfor %}

      <div class="quiz-actions">
        <a class="btn btn-outline" href="{{ url_for('topics.list_topics') }}">â† Back to Topics</a>

        {% if anon %}
          <a class="btn" href="{{ url_for('auth.login', next=url_for('quizzes.quiz', slug=slug)) }}">
            Log in to submit
          </a>
        {% else %}
          <button class="btn" type="submit">Submit Quiz</button>
        {% endif %}
      </div>
    </form>
  </div>
{% endblock %}
